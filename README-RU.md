# Демо Telegram Mini App

В этом репозитории представлен пример разработки мини-приложения "Магазин мини-приложений" для платформы Telegram. Живая тестовая версия приложения доступна по этой ссылке. 

Основные функции:

* просмотр приложений по категориям
* добавление приложений в избранное
* выставление оценки
* запуск приложения прямо из магазина

Вы можете использовать этот репозиторий в качестве отправной точки при разработке своего собственного мини-приложения.

# Структура репозитория

Репозиторий состоит из 2-х основных частей: webapp - frontend часть приложения и backend - backend часть приложения.

## Webapp

webapp представляет собой легковесный UI, отображаемый в боте. Исходный код находится в папке webapp. По своей сути это минималистичный вэб-проект (HTML, CSS, JS) без лишних зависимостей, реализующий концепцию single web page application - все необходимые скрипты и стили для генерации страниц загружаются один раз, а сами страницы строятся на основании небольших порций данных, полученных от backend. Такой подход позволяет минимизировать время, необходимое для генерации новой страницы, что оснобенно важно при реализации плавных и быстрых приложений.

Основная и единственная HTML страница - index.html, представляет собой оболочку, которая подключает необходимые css и js зависимости и содержит единственный элемент frame-root в который динамически помещаются отображаемые страницы. Рассмторим детальнее структуру каталога webapp.

### index.html

Главный файл Telegram Mini App.

### config.js

Файл-конфигуратор, определяет окружение, в котором будет работать на fronend. В данный момент определено одно свойство serverUrl - адрес сервера, куда будут отправляться запросы для получения данных.

### data-repository.js

Данный файл содержит модели данных, используемые в приложении и набор методов для взаимодействия с сервером.

### ui.js

Набор методов-генераторов элементов интерфеса вэб страниц.

### utils.js

Набор обёрток для манипуляции DOM деревом страницы.

### navigation.js

Легковесный фрэймворк для реализации концепции single web page application. Содержит основные методы по замене, добавлению и удалению страниц-экранов в определйнный в index.html фрэйм. Одной из полезных функция является автоматическое обновление свойства window.Telegram.WebApp.BackButton.isVisible при изменении стэка страниц. При работе над своей версий приложения, выполненной на базе текущего проекта, для минимизации ошибок навигации рекомендуется использовать методы из этого файла.

### *-app.js

Страницы приложения. Каждый такой файл содержит метод display* который вызывает при необходимости открыть страницу.

### main.js

Основная точка входа, открывает первую страницу после полной загрузки документа.

### webapp/css

Основной файл style.css - таблица стилей, используемых в приложении. В папке находятся 2 вспомогательных файла: css-class-name-generator.sh и css-class-names.js. Т.к. наше приложение генерирует весь контент на месте, в js файлах, удобно иметь доступ к названиям стилей без необходимости каждый раз копировать их название. Для решения этой задачи можно каждый раз после добавления или изменения класса в файле style.css запускать скрипт css-class-name-generator.sh, который в свою очередь генерирует файл css-class-names.js - js файл с константами названий классов из style.css. Такой подход позволяет использовать автодополнение во время вёрстки блоков в js файлах.

### webapp/stub

Данный каталог содержит единственный файл mock-data-repository.js - файл с переопределёнными методами взаимодействия с bacend (из файла data-repository.js) и некоторый набор мок данных. Для его подключения достаточно раскомментировать соответствующую строку в index.html. Данный файл будет перенаправлять все запросы к серверу в обработчики, определенные в mock-data-repository.js, таким образом запросы не будут уходить на реальный сервер.

## Backend

Backend часть обрабатывает пользовательские запросы. Исходный код находится в папке backend, используется сервер ktor.

# Окружение и инструменты

Рекомендуемое окружение для локального запуска

* *nix система
* Java 17 и выше

Рекомендуемые IDE для работы

* Visual Studio Code для работы с frontend частью
* Intellij idea community edition для работы с backend частью

Сервис для развертывания backend (опционально)

* Heroku или другая аналогичная платформа для развертывания Java приложения

# Использование

Для начала создайте форк репозитория, чтобы была возможность вносить свои изменения и получать обновления, в случае необходимости.

## Режимы запуска

С приложением можно работать в 3-х условных режимах: 

* HTML-only песочница, без backend
* песочница с локальным backend-ом
* production версия

### HTML-only песочница

Данный режим работы с проектом предназначем в первую очередь для вёрстки приложения и тестирования корректности отработки базывах сценариев.